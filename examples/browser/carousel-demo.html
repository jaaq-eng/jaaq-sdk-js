<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JAAQ SDK - Video Carousel Demo</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        background: #f5f5f5;
        padding: 40px 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      .header {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
        text-align: center;
      }

      .header h1 {
        margin-bottom: 8px;
        color: #333;
      }

      .header p {
        color: #666;
        font-size: 14px;
      }

      .card {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }

      .card h2 {
        color: #333;
        margin-bottom: 16px;
        font-size: 20px;
      }

      .info {
        background: #e3f2fd;
        padding: 16px;
        border-radius: 8px;
        margin-bottom: 24px;
        border-left: 4px solid #2196f3;
      }

      .info p {
        color: #1976d2;
        line-height: 1.6;
        margin-bottom: 8px;
      }

      .info code {
        background: rgba(0, 0, 0, 0.1);
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 13px;
      }

      .controls {
        display: flex;
        gap: 12px;
        margin-top: 16px;
        flex-wrap: wrap;
      }

      .controls button {
        background: #2196f3;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.2s;
      }

      .controls button:hover {
        background: #1976d2;
      }

      .controls button:active {
        transform: scale(0.98);
      }

      .event-log {
        background: #263238;
        color: #aed581;
        padding: 16px;
        border-radius: 8px;
        font-family: 'Monaco', 'Courier New', monospace;
        font-size: 13px;
        max-height: 300px;
        overflow-y: auto;
        margin-top: 16px;
      }

      .event-log .event {
        margin-bottom: 4px;
      }

      .event-log .timestamp {
        color: #78909c;
        margin-right: 8px;
      }

      .error {
        background: #ffebee;
        color: #c62828;
        padding: 16px;
        border-radius: 8px;
        border-left: 4px solid #d32f2f;
        margin-bottom: 20px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üé¨ JAAQ Video Carousel Demo</h1>
        <p>Advanced web component example with collection support</p>
      </div>

      <div class="info">
        <p><strong>Setup Instructions:</strong></p>
        <p>1. Load the config using the config loader: <code>./config-loader.js</code></p>
        <p>2. Make sure you have a valid collection ID with videos</p>
        <p>3. The carousel will display up to 3 videos per row, responsive to 1 video on mobile</p>
      </div>

      <div id="error-container"></div>

      <div class="card">
        <h2>Declarative Usage</h2>
        <jaaq-video-carousel id="carousel-1" autoplay="true" max-visible="3"> </jaaq-video-carousel>
      </div>

      <div class="card">
        <h2>Programmatic Usage with Controls</h2>
        <div id="carousel-2-container"></div>
        <div class="controls">
          <button id="btn-prev">‚¨ÖÔ∏è Previous</button>
          <button id="btn-next">Next ‚û°Ô∏è</button>
          <button id="btn-goto-0">Go to Slide 1</button>
          <button id="btn-goto-1">Go to Slide 2</button>
          <button id="btn-goto-2">Go to Slide 3</button>
        </div>
        <div id="event-log" class="event-log"></div>
      </div>
    </div>

    <script type="module">
      const CONFIG_FILE = './config.json';
      const eventLog = document.getElementById('event-log');
      const errorContainer = document.getElementById('error-container');
      let eventCount = 0;
      const MAX_EVENTS = 50;

      function logEvent(type, data) {
        const timestamp = new Date().toLocaleTimeString();
        const eventDiv = document.createElement('div');
        eventDiv.className = 'event';
        eventDiv.innerHTML = `<span class="timestamp">[${timestamp}]</span><strong>${type}:</strong> ${JSON.stringify(data)}`;

        eventLog.insertBefore(eventDiv, eventLog.firstChild);

        eventCount++;
        if (eventCount > MAX_EVENTS) {
          eventLog.removeChild(eventLog.lastChild);
          eventCount--;
        }
      }

      function showError(message) {
        const errorDiv = document.createElement('div');
        errorDiv.className = 'error';
        errorDiv.innerHTML = `<strong>Error:</strong> ${message}`;
        errorContainer.appendChild(errorDiv);
      }

      async function loadConfig() {
        try {
          const response = await fetch(CONFIG_FILE);
          if (!response.ok) {
            throw new Error(`Failed to load config: ${response.statusText}`);
          }
          return await response.json();
        } catch (error) {
          showError(
            `Config file not found. Please create ${CONFIG_FILE} with your API credentials. See config.example.json for reference.`,
          );
          throw error;
        }
      }

      async function initCarousels() {
        const config = await loadConfig();

        if (!config.collectionId) {
          showError('No collectionId found in config. Please add a collectionId to your config.json file.');
          return;
        }

        const carousel1 = document.getElementById('carousel-1');
        if (carousel1) {
          carousel1.setAttribute('collection-id', config.collectionId);
          carousel1.setAttribute('api-key', config.apiKey);
          carousel1.setAttribute('client-id', config.clientId);
          if (config.baseUrl) {
            carousel1.setAttribute('base-url', config.baseUrl);
          }

          carousel1.addEventListener('jaaq:slidechange', (e) => {
            logEvent('slidechange', { index: e.detail.index, videoId: e.detail.video.videoId });
          });

          carousel1.addEventListener('jaaq:videoplay', (e) => {
            logEvent('videoplay', { videoId: e.detail.videoId });
          });

          carousel1.addEventListener('jaaq:error', (e) => {
            logEvent('error', e.detail.message);
            showError(e.detail.message);
          });
        }

        const carousel2 = document.createElement('jaaq-video-carousel');
        carousel2.id = 'carousel-2';
        carousel2.setAttribute('collection-id', config.collectionId);
        carousel2.setAttribute('api-key', config.apiKey);
        carousel2.setAttribute('client-id', config.clientId);
        if (config.baseUrl) {
          carousel2.setAttribute('base-url', config.baseUrl);
        }
        carousel2.setAttribute('autoplay', 'false');
        carousel2.setAttribute('max-visible', '3');

        carousel2.addEventListener('jaaq:slidechange', (e) => {
          logEvent('slidechange', { index: e.detail.index, videoId: e.detail.video.videoId });
        });

        carousel2.addEventListener('jaaq:videoplay', (e) => {
          logEvent('videoplay', { videoId: e.detail.videoId });
        });

        carousel2.addEventListener('jaaq:error', (e) => {
          logEvent('error', e.detail.message);
          showError(e.detail.message);
        });

        document.getElementById('carousel-2-container').appendChild(carousel2);

        document.getElementById('btn-prev').addEventListener('click', () => {
          carousel2.prev();
        });

        document.getElementById('btn-next').addEventListener('click', () => {
          carousel2.next();
        });

        document.getElementById('btn-goto-0').addEventListener('click', () => {
          carousel2.goToSlide(0);
        });

        document.getElementById('btn-goto-1').addEventListener('click', () => {
          carousel2.goToSlide(1);
        });

        document.getElementById('btn-goto-2').addEventListener('click', () => {
          carousel2.goToSlide(2);
        });

        logEvent('init', 'Carousels initialized successfully');
      }

      loadConfig()
        .then(initCarousels)
        .catch((error) => {
          console.error('Failed to initialize:', error);
        });
    </script>

    <script src="../../dist/ui/webcomponents/jaaq-webcomponents-bundled.min.js"></script>
  </body>
</html>
